<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="æœ¬è¯‘æ–‡è¯‘è‡ª Peeking inside a Rust enum
   .dialog { display: flex; flex-direction: row; padding-bottom: 1em; overflow: hidden; } .dialog.amos { flex-direction: row-reverse; } .dialog-head { align-self: flex-start; flex-basis: 48px; width: 48px; height: 48px; margin: 0.2em 0.4em; flex-shrink: 0; } .dialog-text { background-color: #fefdf6; border: 1px solid #ffeb81; max-width: 600px; align-self: flex-start; border-radius: 3px; padding: 0.4rem 0.8rem; overflow: hidden } .dialog.amos .dialog-text { background-color: #f6f9ff; border: 1px solid #cce3f9; } ."><title>æ·±å…¥Rustæšä¸¾</title><link rel=canonical href=https://example.com/posts/translation/rust/peeking_inside_a_rust_enum/><link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="æ·±å…¥Rustæšä¸¾"><meta property="og:description" content="æœ¬è¯‘æ–‡è¯‘è‡ª Peeking inside a Rust enum
   .dialog { display: flex; flex-direction: row; padding-bottom: 1em; overflow: hidden; } .dialog.amos { flex-direction: row-reverse; } .dialog-head { align-self: flex-start; flex-basis: 48px; width: 48px; height: 48px; margin: 0.2em 0.4em; flex-shrink: 0; } .dialog-text { background-color: #fefdf6; border: 1px solid #ffeb81; max-width: 600px; align-self: flex-start; border-radius: 3px; padding: 0.4rem 0.8rem; overflow: hidden } .dialog.amos .dialog-text { background-color: #f6f9ff; border: 1px solid #cce3f9; } ."><meta property="og:url" content="https://example.com/posts/translation/rust/peeking_inside_a_rust_enum/"><meta property="og:site_name" content="Rabbit Hole"><meta property="og:type" content="article"><meta property="article:section" content="Posts"><meta property="article:tag" content="Translation"><meta property="article:tag" content="Rust"><meta property="article:tag" content="Enum"><meta property="article:published_time" content="2021-01-13T11:00:00+08:00"><meta property="article:modified_time" content="2021-01-13T15:00:00+08:00"><meta property="og:image" content="https://example.com/posts/translation/rust/peeking_inside_a_rust_enum/cover.png"><meta name=twitter:title content="æ·±å…¥Rustæšä¸¾"><meta name=twitter:description content="æœ¬è¯‘æ–‡è¯‘è‡ª Peeking inside a Rust enum
   .dialog { display: flex; flex-direction: row; padding-bottom: 1em; overflow: hidden; } .dialog.amos { flex-direction: row-reverse; } .dialog-head { align-self: flex-start; flex-basis: 48px; width: 48px; height: 48px; margin: 0.2em 0.4em; flex-shrink: 0; } .dialog-text { background-color: #fefdf6; border: 1px solid #ffeb81; max-width: 600px; align-self: flex-start; border-radius: 3px; padding: 0.4rem 0.8rem; overflow: hidden } .dialog.amos .dialog-text { background-color: #f6f9ff; border: 1px solid #cce3f9; } ."><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://example.com/posts/translation/rust/peeking_inside_a_rust_enum/cover.png"><link rel="shortcut icon" href=/favicon.ico></head><body class="article-page keep-sidebar"><script>(function(){const colorSchemeKey='StackColorScheme';if(!localStorage.getItem(colorSchemeKey)){localStorage.setItem(colorSchemeKey,"auto");}})();</script><script>(function(){const colorSchemeKey='StackColorScheme';const colorSchemeItem=localStorage.getItem(colorSchemeKey);const supportDarkMode=window.matchMedia('(prefers-color-scheme: dark)').matches===true;if(colorSchemeItem=='dark'||colorSchemeItem==='auto'&&supportDarkMode){document.body.dataset.scheme='dark';}else{document.body.dataset.scheme='light';}})();</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header class=site-info><figure class=site-avatar><img src=/img/avatar_hubab1a6f26c99bd4005799835b3b49dcb_56897_300x0_resize_box_2.png width=300 height=321 class=site-logo loading=lazy alt=Avatar>
<span class=emoji>ğŸ¥</span></figure><h1 class=site-name><a href=https://example.com>Rabbit Hole</a></h1><h2 class=site-description>Tech is and always will be political.</h2></header><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/about><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>About</span></a></li><li><a href=/archives><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>Dark Mode</span></li></ol></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/posts/translation/rust/peeking_inside_a_rust_enum/><img src=/posts/translation/rust/peeking_inside_a_rust_enum/cover_huf0a0302560a2de312014d03b723c5fe2_142416_800x0_resize_box_2.png srcset="/posts/translation/rust/peeking_inside_a_rust_enum/cover_huf0a0302560a2de312014d03b723c5fe2_142416_800x0_resize_box_2.png 800w, /posts/translation/rust/peeking_inside_a_rust_enum/cover_huf0a0302560a2de312014d03b723c5fe2_142416_1600x0_resize_box_2.png 1600w" width=800 height=435 loading=lazy alt="Featured image of post æ·±å…¥Rustæšä¸¾"></a></div><div class=article-details><header class=article-category><a href=/categories/rust/>Rust</a></header><h2 class=article-title><a href=/posts/translation/rust/peeking_inside_a_rust_enum/>æ·±å…¥Rustæšä¸¾</a></h2><footer class=article-time><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--published>Jan 13, 2021</time></footer></div></header><section class=article-content><blockquote><p>æœ¬è¯‘æ–‡è¯‘è‡ª <a class=link href=https://fasterthanli.me/articles/peeking-inside-a-rust-enum target=_blank rel=noopener>Peeking inside a Rust enum</a></p></blockquote><hr><style>.dialog{display:flex;flex-direction:row;padding-bottom:1em;overflow:hidden}.dialog.amos{flex-direction:row-reverse}.dialog-head{align-self:flex-start;flex-basis:48px;width:48px;height:48px;margin:.2em .4em;flex-shrink:0}.dialog-text{background-color:#fefdf6;border:1px solid #ffeb81;max-width:600px;align-self:flex-start;border-radius:3px;padding:.4rem .8rem;overflow:hidden}.dialog.amos .dialog-text{background-color:#f6f9ff;border:1px solid #cce3f9}.tip{line-height:1.6;border-radius:4px;padding:.4rem .8rem;background-color:#fefdf6;border:1px solid #ffeb81}.tip .tip-header{display:flex;align-items:center;justify-content:center;font-weight:700;margin-top:.2em;margin-bottom:.6em}.tip .tip-header img{transform:none;width:3rem;height:3rem}</style><h1 id=å‰è¨€>å‰è¨€</h1><p>åœ¨æˆ‘æœ€è¿‘ <code>Rust Q&A</code> <code>twitch</code> é¢‘é“é‡Œ, æœ‰äº›äººæå‡ºäº†ä¸€ä¸ªçœ‹èµ·æ¥ç®€å•çš„é—®é¢˜: ä¸ºä»€ä¹ˆ <code>small string</code> ç±»å‹, åƒ <code>SmartString</code> or <code>SmolStr</code> å’Œ <code>String</code> æœ‰ç€ä¸€æ ·çš„å¤§å°, ä½†æ˜¯ <code>small vec</code> ç±»å‹, åƒ <code>SmallVec</code> å´è¦æ¯” <code>Vec</code> å¤§?</p><p>æˆ‘çŸ¥é“æˆ‘ä½¿ç”¨äº†ç®€å•ä½œä¸ºå½¢å®¹è¯, ä½†æ˜¯äº‹å®ä¸Šè¦äº†è§£è¿™ä¸ªé—®é¢˜, æˆ‘ä»¬éœ€è¦ä¸€äº›èƒŒæ™¯çŸ¥è¯†</p><blockquote><p>è¯‘è€…: äº¿ç‚¹ç‚¹&mldr;</p></blockquote><h2 id=è¿™ä¸ªé—®é¢˜åˆ°åº•æ˜¯ä»€ä¹ˆ>è¿™ä¸ªé—®é¢˜åˆ°åº•æ˜¯ä»€ä¹ˆ?</h2><p>æˆ‘æœ€è¿‘è°ˆåˆ° <code>Rust</code> <a class=link href=https://fasterthanli.me/articles/small-strings-in-rust target=_blank rel=noopener>small string crates</a>.</p><p>è¢«è¿™äº› <code>crates</code> å¯¼å‡ºçš„ç±»å‹å¯ä»¥é¿å…å¤šæ¬¡å†…å­˜åˆ†é…, å¹¶ä¸”é™ä½å†…å­˜ä½¿ç”¨é‡. è®©æˆ‘ä»¬çœ‹ä¸€ä¸ª <a class=link href=https://lib.rs/crates/smartstring target=_blank rel=noopener>smartstring</a> çš„ä»£ç ä½œä¸ºä¾‹å­.</p><div class=highlight><pre class=chroma><code class=language-rust data-lang=rust><span class=k>use</span><span class=w> </span><span class=n>smartstring</span>::<span class=p>{</span><span class=n>Compact</span><span class=p>,</span><span class=w> </span><span class=n>SmartString</span><span class=p>};</span><span class=w>
</span><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>std</span>::<span class=n>mem</span>::<span class=n>size_of_val</span><span class=p>;</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>smart</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SmartString</span>::<span class=o>&lt;</span><span class=n>Compact</span><span class=o>&gt;</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;hello world&#34;</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=n>dbg</span><span class=o>!</span><span class=p>(</span><span class=n>size_of_val</span><span class=p>(</span><span class=o>&amp;</span><span class=n>smart</span><span class=p>));</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>stand</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;hello world&#34;</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=n>dbg</span><span class=o>!</span><span class=p>(</span><span class=n>size_of_val</span><span class=p>(</span><span class=o>&amp;</span><span class=n>stand</span><span class=p>));</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ cargo run -q
<span class=o>[</span>src/main.rs:6<span class=o>]</span> size_of_val<span class=o>(</span><span class=p>&amp;</span>smart<span class=o>)</span> <span class=o>=</span> <span class=m>24</span>
<span class=o>[</span>src/main.rs:9<span class=o>]</span> size_of_val<span class=o>(</span><span class=p>&amp;</span>stand<span class=o>)</span> <span class=o>=</span> <span class=m>24</span>
</code></pre></div><p>æ­£å¦‚ä½ çœ‹åˆ°çš„, åŒæ ·ä¹Ÿæ˜¯æœ€åˆçš„é—®é¢˜æè¿°çš„é‚£æ ·, è¿™ä¸¤ä¸ªç±»å‹çš„å¤§å°æ˜¯ç›¸åŒçš„.</p><div class=dialog><img src=./bear.svg class=dialog-head><div class=dialog-text><p>æ¯«æ— ç–‘é—®çš„, `String` å­˜å‚¨å®é™…æ•°æ®æ˜¯åœ¨åˆ«çš„åœ°æ–¹? å› ä¸ºæ‰€æœ‰ `String` ç±»å‹å€¼çš„å¤§å°åœ¨64ä½å¹³å°ä¸Šéƒ½æ˜¯24ä¸ªå­—èŠ‚.</p></div></div><p>æ˜¯çš„, è¿™å½“ç„¶ä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ•…äº‹, åœ¨è¿™ä¸ªç‰¹åˆ«çš„ä¾‹å­ä¸­, <code>smart</code> ä»¥ <code>inline</code> çš„æ–¹å¼å­˜å‚¨å®ƒçš„å€¼(åœ¨æ ˆä¸Š), è€Œæ ‡å‡†åº“å°†å€¼å­˜å‚¨åœ¨å †ä¸Š:</p><p><img src=./heap-vs-not-heap.svg></p><p>å¦‚æœæˆ‘ä»¬æƒ³çŸ¥é“æ¯ä¸ªç±»å‹åˆ°åº•æ€»å…±ä½¿ç”¨äº†å¤šå°‘å†…å­˜, æˆ‘ä»¬å¯ä»¥è¿™æ ·åš:</p><div class=highlight><pre class=chroma><code class=language-rust data-lang=rust><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>smart</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SmartString</span>::<span class=o>&lt;</span><span class=n>Compact</span><span class=o>&gt;</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;hello world&#34;</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=n>dbg</span><span class=o>!</span><span class=p>(</span><span class=n>size_of_val</span><span class=p>(</span><span class=o>&amp;</span><span class=n>smart</span><span class=p>));</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>stand</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;hello world&#34;</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=n>dbg</span><span class=o>!</span><span class=p>(</span><span class=n>size_of_val</span><span class=p>(</span><span class=o>&amp;</span><span class=n>stand</span><span class=p>)</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>stand</span><span class=p>.</span><span class=n>capacity</span><span class=p>());</span><span class=w>
</span></code></pre></div><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ cargo run -q
<span class=o>[</span>src/main.rs:6<span class=o>]</span> size_of_val<span class=o>(</span><span class=p>&amp;</span>smart<span class=o>)</span> <span class=o>=</span> <span class=m>24</span>
<span class=o>[</span>src/main.rs:9<span class=o>]</span> size_of_val<span class=o>(</span><span class=p>&amp;</span>stand<span class=o>)</span> + stand.capacity<span class=o>()</span> <span class=o>=</span> <span class=m>35</span>
</code></pre></div><div class=dialog><img src=./bear.svg class=dialog-head><div class=dialog-text><p>å¥½å§, ä½†æ˜¯ - ä½ è¯´ <code>String</code> æ˜¾è€Œæ˜“è§åœ¨å †ä¸­å­˜æ”¾å®ƒçš„å†…å®¹. æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥æ­£å¼è¿™ä¸ªè¯´æ³•ä¹ˆ?</p></div></div><div class="dialog amos"><img src=./author.svg class=dialog-head><div class=dialog-text><p>å½“ç„¶æœ‰!</p></div></div><p>å…¸å‹çš„, åœ¨ <code>Linux 64-bit</code> ç³»ç»Ÿä¸­æ ˆå’Œå †åœ¨è™šæ‹Ÿåœ°å€ä¸­çš„ç©ºé—´ç›¸å·®å¾ˆè¿œ, è¿™æ„å‘³ç€æˆ‘ä»¬å¦‚æœæ‰“å°å­—ç¬¦ä¸²çš„å…ƒæ•°æ®çš„åœ°å€å’Œå†…å®¹çš„åœ°å€, æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°:</p><ul><li><code>SmartString</code> çš„å…ƒæ•°æ®å’Œå†…å®¹åœ¨ç›¸é‚»çš„ä½ç½®.</li><li><code>String</code> çš„å…ƒæ•°æ®å’Œå†…å®¹ç›¸è·å¾ˆè¿œ.</li></ul><div class=highlight><pre class=chroma><code class=language-rust data-lang=rust><span class=k>use</span><span class=w> </span><span class=n>smartstring</span>::<span class=p>{</span><span class=n>Compact</span><span class=p>,</span><span class=w> </span><span class=n>SmartString</span><span class=p>};</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>smart</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SmartString</span>::<span class=o>&lt;</span><span class=n>Compact</span><span class=o>&gt;</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;hello world&#34;</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>smart_meta</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>smart</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=o>*</span><span class=k>const</span><span class=w> </span><span class=n>_</span><span class=p>;</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>smart_data</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>smart</span><span class=p>.</span><span class=n>as_bytes</span><span class=p>()[</span><span class=mi>0</span><span class=p>]</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=o>*</span><span class=k>const</span><span class=w> </span><span class=n>_</span><span class=p>;</span><span class=w>
</span><span class=w>    </span><span class=n>dbg</span><span class=o>!</span><span class=p>((</span><span class=n>smart_meta</span><span class=p>,</span><span class=w> </span><span class=n>smart_data</span><span class=p>));</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>stand</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=s>&#34;hello world&#34;</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>stand_meta</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>stand</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=o>*</span><span class=k>const</span><span class=w> </span><span class=n>_</span><span class=p>;</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>stand_data</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>stand</span><span class=p>.</span><span class=n>as_bytes</span><span class=p>()[</span><span class=mi>0</span><span class=p>]</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=o>*</span><span class=k>const</span><span class=w> </span><span class=n>_</span><span class=p>;</span><span class=w>
</span><span class=w>    </span><span class=n>dbg</span><span class=o>!</span><span class=p>((</span><span class=n>stand_meta</span><span class=p>,</span><span class=w> </span><span class=n>stand_data</span><span class=p>));</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ cargo run -q
<span class=o>[</span>src/main.rs:7<span class=o>]</span> <span class=o>(</span>smart_meta, smart_data<span class=o>)</span> <span class=o>=</span> <span class=o>(</span>
    0x00007ffce4cf4728,
    0x00007ffce4cf4729,
<span class=o>)</span>
<span class=o>[</span>src/main.rs:12<span class=o>]</span> <span class=o>(</span>stand_meta, stand_data<span class=o>)</span> <span class=o>=</span> <span class=o>(</span>
    0x00007ffce4cf47f8,
    0x0000555f87686a60,
<span class=o>)</span>
</code></pre></div><div class=dialog><img src=./bear.svg class=dialog-head><div class=dialog-text><p>å¥½å§, æˆ‘ä¿¡äº†. é‚£ä¹ˆ <code>smart</code> æ€»æ˜¯æŠŠå®ƒçš„æ•°æ®å­˜å‚¨åœ¨æ ˆä¸­å—?</p></div></div><p>ä¸! åªæœ‰åœ¨å°äº24å­—èŠ‚çš„æ—¶å€™æ˜¯å­˜å‚¨åœ¨æ ˆä¸Šçš„, å°±å’Œ <code>String</code> ä¸€æ ·. æˆ‘ä»¬ç”¨ç¨å¾®é•¿ä¸€ç‚¹çš„å­—ç¬¦ä¸²æ¥çœ‹çœ‹.</p><div class=highlight><pre class=chroma><code class=language-rust data-lang=rust><span class=k>use</span><span class=w> </span><span class=n>smartstring</span>::<span class=p>{</span><span class=n>Compact</span><span class=p>,</span><span class=w> </span><span class=n>SmartString</span><span class=p>};</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>input</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;Turns out you can blame your tools *and* be a good craftsperson. Who knew?&#34;</span><span class=p>;</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>smart</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SmartString</span>::<span class=o>&lt;</span><span class=n>Compact</span><span class=o>&gt;</span>::<span class=n>from</span><span class=p>(</span><span class=n>input</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>smart_meta</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>smart</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=o>*</span><span class=k>const</span><span class=w> </span><span class=n>_</span><span class=p>;</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>smart_data</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>smart</span><span class=p>.</span><span class=n>as_bytes</span><span class=p>()[</span><span class=mi>0</span><span class=p>]</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=o>*</span><span class=k>const</span><span class=w> </span><span class=n>_</span><span class=p>;</span><span class=w>
</span><span class=w>    </span><span class=n>dbg</span><span class=o>!</span><span class=p>((</span><span class=n>smart_meta</span><span class=p>,</span><span class=w> </span><span class=n>smart_data</span><span class=p>));</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>stand</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>String</span>::<span class=n>from</span><span class=p>(</span><span class=n>input</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>stand_meta</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>stand</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=o>*</span><span class=k>const</span><span class=w> </span><span class=n>_</span><span class=p>;</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>stand_data</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>stand</span><span class=p>.</span><span class=n>as_bytes</span><span class=p>()[</span><span class=mi>0</span><span class=p>]</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=o>*</span><span class=k>const</span><span class=w> </span><span class=n>_</span><span class=p>;</span><span class=w>
</span><span class=w>    </span><span class=n>dbg</span><span class=o>!</span><span class=p>((</span><span class=n>stand_meta</span><span class=p>,</span><span class=w> </span><span class=n>stand_data</span><span class=p>));</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ cargo run -q
<span class=o>[</span>src/main.rs:9<span class=o>]</span> <span class=o>(</span>smart_meta, smart_data<span class=o>)</span> <span class=o>=</span> <span class=o>(</span>
    0x00007ffd460d0268,
    0x0000555f4636ca30,
<span class=o>)</span>
<span class=o>[</span>src/main.rs:14<span class=o>]</span> <span class=o>(</span>stand_meta, stand_data<span class=o>)</span> <span class=o>=</span> <span class=o>(</span>
    0x00007ffd460d0338,
    0x0000555f4636cac0,
<span class=o>)</span>
</code></pre></div><p>&mldr;ç„¶åæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°è¿™ä¸¤ä¸ªç±»å‹çš„å†…å®¹ç°åœ¨éƒ½æ”¾åœ¨å †ä¸Šäº†.</p><div class=dialog><img src=./bear.svg class=dialog-head><div class=dialog-text><p>è¿™æ ·, é‚£ <code>SmartString</code> æ˜¯å¦æ„å‘³ç€ä¹°ä¸€é€ä¸€çš„å¤„ç†æ–¹å¼? è¿™å’Œä»–çš„ç±»å‹æœ‰å…³?</p><br><p>å®ƒæ˜¯æ€ä¹ˆå·¥ä½œçš„?</p></div></div><div class="dialog amos"><img src=./author.svg class=dialog-head><div class=dialog-text><p>å¤šä¹ˆå¥½çš„ä¸€ä¸ªé—®é¢˜. è®©æˆ‘ä»¬è°ˆè°ˆæšä¸¾</p></div></div><h2 id=ä¸€ä¸ªå•è¯-å¤šç§æ„ä¹‰>ä¸€ä¸ªå•è¯, å¤šç§æ„ä¹‰</h2><p>å¦‚æœä½ æœ‰ç€ <code>C/C++/Java/C#</code> çš„è¯­è¨€èƒŒæ™¯, ä¸€ä¸ª <code>enum</code> ä»…ä»…æ„å‘³ç€ä¸€ä¸ª <code>Integer</code> ç±»å‹, åªæ˜¯å®ƒçš„å€¼æœ‰ç€è‡ªå·±çš„æ„ä¹‰.</p><p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸ª <code>C</code> çš„ä¾‹å­:</p><div class=highlight><pre class=chroma><code class=language-c data-lang=c><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span><span class=cp></span>
<span class=k>enum</span> <span class=n>Drink</span> <span class=p>{</span>
    <span class=n>Water</span><span class=p>,</span>
    <span class=n>Soda</span><span class=p>,</span>
    <span class=n>Juice</span><span class=p>,</span>
<span class=p>};</span>

<span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
    <span class=k>enum</span> <span class=n>Drink</span> <span class=n>dri</span> <span class=o>=</span> <span class=n>Soda</span><span class=p>;</span>
    <span class=n>printf</span><span class=p>(</span><span class=s>&#34;dri = %d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>dri</span><span class=p>);</span>
    <span class=n>printf</span><span class=p>(</span><span class=s>&#34;sizeof(dri) = %ld</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>dri</span><span class=p>));</span>
    <span class=n>printf</span><span class=p>(</span><span class=s>&#34;sizeof(int) = %ld</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=kt>int</span><span class=p>));</span>
<span class=p>}</span>
</code></pre></div><p>è¿™é‡Œ, æˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ªæšä¸¾ç±»å‹ <code>enum Drink</code>, æœ‰ä¸‰ä¸ªå˜ä½“, ä¸è¿‡ä»…ä»…æ˜¯ä»0å¼€å§‹çš„æ•°å­—, æ‰€ä»¥æˆ‘ä»¬æœ‰ <code>Water = 0</code>, <code>Soda = 1</code>, <code>Juice = 2</code>:</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ clang -Wall main.c -o main <span class=o>&amp;&amp;</span> ./main
<span class=nv>dri</span> <span class=o>=</span> <span class=m>1</span>
sizeof<span class=o>(</span>dri<span class=o>)</span> <span class=o>=</span> <span class=m>4</span>
sizeof<span class=o>(</span>int<span class=o>)</span> <span class=o>=</span> <span class=m>4</span>
</code></pre></div><p>ç„¶è€Œæˆ‘ä¸æ˜¯å¾ˆå–œæ¬¢è¿™ä¸ªä»£ç , æˆ‘ä¸æƒ³è¦é¢å¤–çš„é™å®šè¯, å¹¶ä¸”æƒ³è¦æˆ‘çš„å˜ä½“æœ‰ç€è‡ªå·±çš„å‘½åç©ºé—´, ä½†åœ¨ <code>C</code> é‡Œé¢æˆ‘ä»¬éœ€è¦è‡ªå·±åšè¿™äº›äº‹:</p><div class=highlight><pre class=chroma><code class=language-c data-lang=c><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span><span class=cp></span>
<span class=c1>// this could also be done in two separate declarations
</span><span class=c1></span><span class=k>typedef</span> <span class=k>enum</span> <span class=n>Drink</span> <span class=p>{</span>
    <span class=n>Drink_Water</span><span class=p>,</span>
    <span class=n>Drink_Soda</span><span class=p>,</span>
    <span class=n>Drink_Juice</span><span class=p>,</span>
<span class=p>}</span> <span class=n>Drink</span><span class=p>;</span>

<span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
    <span class=n>Drink</span> <span class=n>dri</span> <span class=o>=</span> <span class=n>Drink_Soda</span><span class=p>;</span>
    <span class=n>printf</span><span class=p>(</span><span class=s>&#34;dri = %d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>dri</span><span class=p>);</span>
    <span class=n>printf</span><span class=p>(</span><span class=s>&#34;sizeof(dri) = %ld</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>dri</span><span class=p>));</span>
    <span class=n>printf</span><span class=p>(</span><span class=s>&#34;sizeof(int) = %ld</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=kt>int</span><span class=p>));</span>
<span class=p>}</span>
</code></pre></div><p>Ahhh, å¥½å¤šäº†. ä½†æ˜¯è¿™é‡Œä»ç„¶æœ‰å…¶å®ƒçš„ä¸œè¥¿æˆ‘ä¸æ˜¯ç‰¹åˆ«å–œæ¬¢, åƒæ˜¯ <code>C</code> çš„ <code>switch</code>. ä¸‹é¢çš„ä»£ç æ˜¯é”™è¯¯çš„:</p><div class=highlight><pre class=chroma><code class=language-c data-lang=c><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span><span class=cp></span>
<span class=k>typedef</span> <span class=k>enum</span> <span class=n>Drink</span> <span class=p>{</span>
    <span class=n>Drink_Water</span><span class=p>,</span>
    <span class=n>Drink_Soda</span><span class=p>,</span>
    <span class=n>Drink_Juice</span><span class=p>,</span>
<span class=p>}</span> <span class=n>Drink</span><span class=p>;</span>

<span class=kt>void</span> <span class=nf>print_drink</span><span class=p>(</span><span class=n>Drink</span> <span class=n>dri</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>switch</span> <span class=p>(</span><span class=n>dri</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>case</span> <span class=nl>Drink_Water</span><span class=p>:</span>
            <span class=n>printf</span><span class=p>(</span><span class=s>&#34;It&#39;s water!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
        <span class=k>case</span> <span class=nl>Drink_Soda</span><span class=p>:</span>
            <span class=n>printf</span><span class=p>(</span><span class=s>&#34;It&#39;s soda!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
        <span class=k>case</span> <span class=nl>Drink_Juice</span><span class=p>:</span>
            <span class=n>printf</span><span class=p>(</span><span class=s>&#34;It&#39;s juice!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>

<span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
    <span class=n>print_drink</span><span class=p>(</span><span class=n>Drink_Soda</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div><p>æ­£ç¡®çš„ä»£ç æ˜¯åœ¨æ¯ä¸ª <code>case</code> è¯­å¥çš„ç»“å°¾éƒ½ä½¿ç”¨ <code>break</code>. è¿™æ˜¯åˆšèµ·æ­¥çš„å¼€å‘äººå‘˜å¾ˆæ—©å°±åº”è¯¥äº†è§£çš„äº‹æƒ…ä¹‹ä¸€.</p><div class=tip><div class=tip-header><img src=./bear.svg>
Cool bear's hot tip</div>é¹…å¦¹å­å˜¤, åœ¨ `C#` ä¸­æ˜¯å¼ºåˆ¶è¦æ±‚åœ¨æ¯ä¸ªéç©ºçš„ <code>case</code> ä¸­æ·»åŠ  <code>break</code> å¦åˆ™ä¸èƒ½ç¼–è¯‘é€šè¿‡, è¿™é˜²æ­¢ä½ ç¡¬ç¼–ç é”™è¯¯è€Œå¯¼è‡´çš„éšå¼è·Œè½(æ„æ€æ˜¯æ²¡æœ‰ <code>break</code> çš„æƒ…å†µå°±ä¸€ä¸ª <code>case</code> ä¸€ä¸ª <code>case</code> å‘ä¸‹è¿è¡Œ), å¦‚æœå–œæ¬¢çš„è¯ä½ ä»ç„¶å¯ä»¥å®ç°ä¸€ä¸ª <a href=https://stackoverflow.com/questions/174155/switch-statement-fallthrough-in-c/174223#174223>æ˜ç¡®çš„è·Œè½</a>.</div><p>å³ä½¿æˆ‘ä»¬ä¿®å¤äº† <code>switch</code> çš„é—®é¢˜, è¿˜æœ‰ä»¶æˆ‘ä¸å–œæ¬¢ <code>C</code> æšä¸¾çš„äº‹æƒ…, é‚£å°±æ˜¯æ²¡ä»€ä¹ˆå¯ä»¥é˜»æ­¢æˆ‘ä¼ é€’ä¸€ä¸ªæ— æ„ä¹‰çš„å€¼:</p><div class=highlight><pre class=chroma><code class=language-c data-lang=c><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span><span class=cp></span>
<span class=k>typedef</span> <span class=k>enum</span> <span class=n>Drink</span> <span class=p>{</span>
    <span class=n>Drink_Water</span><span class=p>,</span>
    <span class=n>Drink_Soda</span><span class=p>,</span>
    <span class=n>Drink_Juice</span><span class=p>,</span>
<span class=p>}</span> <span class=n>Drink</span><span class=p>;</span>

<span class=kt>void</span> <span class=nf>print_drink</span><span class=p>(</span><span class=n>Drink</span> <span class=n>dri</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>switch</span> <span class=p>(</span><span class=n>dri</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>case</span> <span class=nl>Drink_Water</span><span class=p>:</span>
            <span class=n>printf</span><span class=p>(</span><span class=s>&#34;It&#39;s water!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
            <span class=k>break</span><span class=p>;</span>
        <span class=k>case</span> <span class=nl>Drink_Soda</span><span class=p>:</span>
            <span class=n>printf</span><span class=p>(</span><span class=s>&#34;It&#39;s soda!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
            <span class=k>break</span><span class=p>;</span>
        <span class=k>case</span> <span class=nl>Drink_Juice</span><span class=p>:</span>
            <span class=n>printf</span><span class=p>(</span><span class=s>&#34;It&#39;s juice!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
            <span class=k>break</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>

<span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
    <span class=n>print_drink</span><span class=p>(</span><span class=mi>47</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ clang -Wall main.c -o main <span class=o>&amp;&amp;</span> ./main
</code></pre></div><p>ç°åœ¨, å¦‚æœæˆ‘ä»¬çœ‹çœ‹ <code>Rust</code> çš„æšä¸¾&mldr; è¿™æ˜¯ä¸ªå®Œå…¨ä¸åŒçš„äº‹æƒ….</p><p>è®©æˆ‘ä»¬å°½é‡å†™ä¸€ä¸ªç›¸åŒçš„ç¨‹åº.</p><div class=highlight><pre class=chroma><code class=language-rust data-lang=rust><span class=k>use</span><span class=w> </span><span class=n>std</span>::<span class=n>mem</span>::<span class=n>size_of_val</span><span class=p>;</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>enum</span> <span class=nc>Drink</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>Water</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>Soda</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>Juice</span><span class=p>,</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>dri</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Drink</span>::<span class=n>Water</span><span class=p>;</span><span class=w>
</span><span class=w>    </span><span class=n>dbg</span><span class=o>!</span><span class=p>(</span><span class=n>size_of_val</span><span class=p>(</span><span class=o>&amp;</span><span class=n>dri</span><span class=p>));</span><span class=w>
</span><span class=w>    </span><span class=n>dbg</span><span class=o>!</span><span class=p>(</span><span class=n>dri</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=kt>u32</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ cargo run -q
warning: variant is never constructed: <span class=sb>`</span>Soda<span class=sb>`</span>
 --&gt; src/main.rs:5:5
  <span class=p>|</span>
<span class=m>5</span> <span class=p>|</span>     Soda,
  <span class=p>|</span>     ^^^^
  <span class=p>|</span>
  <span class=o>=</span> note: <span class=sb>`</span><span class=c1>#[warn(dead_code)]` on by default</span>

warning: variant is never constructed: <span class=sb>`</span>Juice<span class=sb>`</span>
 --&gt; src/main.rs:6:5
  <span class=p>|</span>
<span class=m>6</span> <span class=p>|</span>     Juice,
  <span class=p>|</span>     ^^^^^

warning: <span class=m>2</span> warnings emitted

<span class=o>[</span>src/main.rs:11<span class=o>]</span> size_of_val<span class=o>(</span><span class=p>&amp;</span>dri<span class=o>)</span> <span class=o>=</span> <span class=m>1</span>
<span class=o>[</span>src/main.rs:12<span class=o>]</span> dri as <span class=nv>u32</span> <span class=o>=</span> <span class=m>0</span>
</code></pre></div><p>é‚£ä¹ˆæˆ‘ä»¬æ˜æ˜¾åœ°å¾—åˆ°äº†ä»€ä¹ˆå¥½å¤„å‘¢?</p><div class=dialog><img src=./bear.svg class=dialog-head><div class=dialog-text><p>è®©æˆ‘çœ‹çœ‹, è¿™çœ‹èµ·æ¥åƒæ˜¯ä¸€ä¸ª <code>Integer</code> ç±»å‹ - è‡³å°‘, æˆ‘èƒ½æŠŠå®ƒè½¬å‹ä¸ºä¸€ä¸ª <code>u32</code>. ä½†æ˜¯å®ƒé»˜è®¤å°±æœ‰å‘½åç©ºé—´?</p></div></div><p>å¯¹çš„, ä½†é‚£å¹¶ä¸æ˜¯å…¨éƒ¨! ç¼–è¯‘å™¨è­¦å‘Šæˆ‘ä»¬æœ‰æ²¡æœ‰ä½¿ç”¨çš„å˜ä½“, å¹¶ä¸”æˆ‘ä»¬å¯ä»¥ç®€å•åœ°ç»™è¿™ä¸ªæšä¸¾æ´¾ç”Ÿä¸€ä¸ª <code>Debug</code> trait çš„å®ç°:</p><div class=highlight><pre class=chroma><code class=language-rust data-lang=rust><span class=cp>#[derive(Debug)]</span><span class=w>
</span><span class=w></span><span class=k>enum</span> <span class=nc>Drink</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>Water</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>Soda</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>Juice</span><span class=p>,</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>print_drink</span><span class=p>(</span><span class=o>&amp;</span><span class=n>Drink</span>::<span class=n>Water</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=n>print_drink</span><span class=p>(</span><span class=o>&amp;</span><span class=n>Drink</span>::<span class=n>Juice</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=n>print_drink</span><span class=p>(</span><span class=o>&amp;</span><span class=n>Drink</span>::<span class=n>Soda</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>fn</span> <span class=nf>print_drink</span><span class=p>(</span><span class=n>dri</span>: <span class=kp>&amp;</span><span class=nc>Drink</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;{:?}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>dri</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ cargo run -q
Water
Juice
Soda
</code></pre></div><p>&mldr;å¹¶ä¸”å‡å¦‚æˆ‘ä»¬ä¸é‚£ä¹ˆåš, æˆ‘ä»¬ä¹Ÿèƒ½ä½¿ç”¨ <code>match</code> è€Œä¸æ˜¯ <code>switch</code>, <code>match</code> ä¼šæ£€æŸ¥æ˜¯å¦åŒ¹é…äº†æšä¸¾çš„æ‰€æœ‰å˜ä½“, ä¸¾ä¸ªä¾‹å­, ä¸‹é¢çš„ä»£ç ä¸èƒ½é€šè¿‡ç¼–è¯‘:</p><div class=highlight><pre class=chroma><code class=language-rust data-lang=rust><span class=k>fn</span> <span class=nf>print_drink</span><span class=p>(</span><span class=n>dri</span>: <span class=kp>&amp;</span><span class=nc>Drink</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=k>match</span><span class=w> </span><span class=n>dri</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=n>Drink</span>::<span class=n>Water</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;it&#39;s water!&#34;</span><span class=p>),</span><span class=w>
</span><span class=w>        </span><span class=n>Drink</span>::<span class=n>Soda</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;it&#39;s soda!&#34;</span><span class=p>),</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ cargo run -q
error<span class=o>[</span>E0004<span class=o>]</span>: non-exhaustive patterns: <span class=sb>`</span><span class=p>&amp;</span>Juice<span class=sb>`</span> not covered
  --&gt; src/main.rs:15:11
   <span class=p>|</span>
<span class=m>2</span>  <span class=p>|</span> / enum Drink <span class=o>{</span>
<span class=m>3</span>  <span class=p>|</span> <span class=p>|</span>     Water,
<span class=m>4</span>  <span class=p>|</span> <span class=p>|</span>     Soda,
<span class=m>5</span>  <span class=p>|</span> <span class=p>|</span>     Juice,
   <span class=p>|</span> <span class=p>|</span>     ----- not covered
<span class=m>6</span>  <span class=p>|</span> <span class=p>|</span> <span class=o>}</span>
   <span class=p>|</span> <span class=p>|</span>_- <span class=sb>`</span>Drink<span class=sb>`</span> defined here
...
<span class=m>15</span> <span class=p>|</span>       match dri <span class=o>{</span>
   <span class=p>|</span>             ^^^ pattern <span class=sb>`</span><span class=p>&amp;</span>Juice<span class=sb>`</span> not covered
   <span class=p>|</span>
   <span class=o>=</span> help: ensure that all possible cases are being handled, possibly by adding wildcards or more match <span class=nv>arms</span>
   <span class=o>=</span> note: the matched value is of <span class=nb>type</span> <span class=sb>`</span><span class=p>&amp;</span>Drink<span class=sb>`</span>
</code></pre></div><p>ç¼–è¯‘å™¨ç»™å‡ºäº†ä¸¤ç§å¯èƒ½çš„æ–¹æ³•æ¥ä¿®å¤è¿™ä¸ªé—®é¢˜, æˆ–æ˜¯æ·»åŠ ä¸€ä¸ªé€šé…ç¬¦:</p><div class=highlight><pre class=chroma><code class=language-rust data-lang=rust><span class=k>fn</span> <span class=nf>print_drink</span><span class=p>(</span><span class=n>dri</span>: <span class=kp>&amp;</span><span class=nc>Drink</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=k>match</span><span class=w> </span><span class=n>dri</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=n>Drink</span>::<span class=n>Water</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;it&#39;s water!&#34;</span><span class=p>),</span><span class=w>
</span><span class=w>        </span><span class=n>Drink</span>::<span class=n>Soda</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;it&#39;s soda!&#34;</span><span class=p>),</span><span class=w>
</span><span class=w>        </span><span class=n>_</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;it&#39;s something we don&#39;t know about!&#34;</span><span class=p>),</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div><p>æˆ–è€…æ˜¯è¦†ç›–åˆ°æ‰€æœ‰çš„æƒ…å†µ:</p><div class=highlight><pre class=chroma><code class=language-rust data-lang=rust><span class=k>fn</span> <span class=nf>print_drink</span><span class=p>(</span><span class=n>dri</span>: <span class=kp>&amp;</span><span class=nc>Drink</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=k>match</span><span class=w> </span><span class=n>dri</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=n>Drink</span>::<span class=n>Water</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;it&#39;s water!&#34;</span><span class=p>),</span><span class=w>
</span><span class=w>        </span><span class=n>Drink</span>::<span class=n>Soda</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;it&#39;s soda!&#34;</span><span class=p>),</span><span class=w>
</span><span class=w>        </span><span class=n>Drink</span>::<span class=n>Juice</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;it&#39;s juice!&#34;</span><span class=p>),</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div><div class=tip><div class=tip-header><img src=./bear.svg>
Cool bear's hot tip</div>è¿™å¬èµ·æ¥æ˜¯ä¸æ˜¯è¦æ•²å¾ˆå¤šä»£ç ? å¹¸è¿çš„æ˜¯, <code>rust-analyzer</code> å¯ä»¥å¸®å¿™è¡¥å…¨ <code>case</code>, è¿™å¸®æˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆçš„å¾ˆå¤§ä¸€éƒ¨åˆ†ä»£ç .</div><p>è®²åˆ° <code>match</code>, å®ƒä¹Ÿæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼, æ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥è¿™ä¹ˆåš:</p><div class=highlight><pre class=chroma><code class=language-rust data-lang=rust><span class=k>fn</span> <span class=nf>print_drink</span><span class=p>(</span><span class=n>dri</span>: <span class=kp>&amp;</span><span class=nc>Drink</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=w>
</span><span class=w>        </span><span class=s>&#34;{}&#34;</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=k>match</span><span class=w> </span><span class=n>dri</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>            </span><span class=n>Drink</span>::<span class=n>Water</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=s>&#34;it&#39;s water!&#34;</span><span class=p>,</span><span class=w>
</span><span class=w>            </span><span class=n>Drink</span>::<span class=n>Soda</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=s>&#34;it&#39;s soda!&#34;</span><span class=p>,</span><span class=w>
</span><span class=w>            </span><span class=n>Drink</span>::<span class=n>Juice</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=s>&#34;it&#39;s juice!&#34;</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=p>}</span><span class=w>
</span><span class=w>    </span><span class=p>)</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div><p>å°½ç®¡å°±æˆ‘ä¸ªäººè€Œè¨€, æˆ‘å¯èƒ½æ›´å€¾å‘äºè¿™æ ·å†™:</p><div class=highlight><pre class=chroma><code class=language-rust data-lang=rust><span class=k>fn</span> <span class=nf>print_drink</span><span class=p>(</span><span class=n>dri</span>: <span class=kp>&amp;</span><span class=nc>Drink</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>match</span><span class=w> </span><span class=n>dri</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=n>Drink</span>::<span class=n>Water</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=s>&#34;water&#34;</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=n>Drink</span>::<span class=n>Soda</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=s>&#34;soda&#34;</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=n>Drink</span>::<span class=n>Juice</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=s>&#34;juice&#34;</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=p>};</span><span class=w>
</span><span class=w>    </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;it&#39;s {}!&#34;</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>)</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div><p>è®©æˆ‘ä»¬æƒ³æƒ³, æˆ‘ä»¬è¿˜æŠ±æ€¨äº† <code>C</code> æšä¸¾çš„ä»€ä¹ˆåœ°æ–¹?</p><div class=dialog><img src=./bear.svg class=dialog-head><div class=dialog-text><p>ä½ å¯ä»¥ä¼ é€’æ— æ„ä¹‰çš„å€¼!</p></div></div><p>å¯¹! è®©æˆ‘ä»¬è¯•è¯•:</p><div class=highlight><pre class=chroma><code class=language-rust data-lang=rust><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>print_drink</span><span class=p>(</span><span class=o>&amp;</span><span class=n>Drink</span>::<span class=n>Water</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=n>print_drink</span><span class=p>(</span><span class=o>&amp;</span><span class=n>Drink</span>::<span class=n>Juice</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=n>print_drink</span><span class=p>(</span><span class=o>&amp;</span><span class=n>Drink</span>::<span class=n>Soda</span><span class=p>);</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>val</span>: <span class=nc>Drink</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>4</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>Drink</span><span class=p>;</span><span class=w>
</span><span class=w>    </span><span class=n>print_drink</span><span class=p>(</span><span class=o>&amp;</span><span class=n>val</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ cargo run -q
error<span class=o>[</span>E0605<span class=o>]</span>: non-primitive cast: <span class=sb>`</span>i32<span class=sb>`</span> as <span class=sb>`</span>Drink<span class=sb>`</span>
  --&gt; src/main.rs:13:22
   <span class=p>|</span>
<span class=m>13</span> <span class=p>|</span>     <span class=nb>let</span> val: <span class=nv>Drink</span> <span class=o>=</span> <span class=m>4</span> as Drink<span class=p>;</span>
   <span class=p>|</span>                      ^^^^^^^^^^
   <span class=p>|</span>
   <span class=o>=</span> note: an <span class=sb>`</span>as<span class=sb>`</span> expression can only be used to convert between primitive types. Consider using the <span class=sb>`</span>From<span class=sb>`</span> traitt
</code></pre></div><p>Ah, è¿™çœ‹èµ·æ¥å¹¶ä¸èƒ½å·¥ä½œ! ç„¶è€Œåœ¨æŸäº›æƒ…å½¢ä¸­æˆ‘ä»¬å¯èƒ½éœ€è¦è¿™ä¹ˆåš, æˆ‘ä»¬å¯ä»¥è§£æä¸€ä¸ªäºŒè¿›åˆ¶æ ¼å¼, å¹¶ä¸”å·²ç»ç¡®ä¿æ£€æŸ¥è¿™ä¸ªæ•°å­—ç±»å‹çš„å€¼åœ¨è¿™ä¸ªæšä¸¾ä¸­æ˜¯æœ‰æ„ä¹‰çš„ - é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>transmute</code>:</p><div class=highlight><pre class=chroma><code class=language-rust data-lang=rust><span class=cp>#[allow(dead_code)]</span><span class=w>
</span><span class=w></span><span class=k>enum</span> <span class=nc>Drink</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>Water</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>Soda</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>Juice</span><span class=p>,</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>juice_from_binary_format</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>val</span>: <span class=nc>Drink</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>unsafe</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>std</span>::<span class=n>mem</span>::<span class=n>transmute</span><span class=p>(</span><span class=n>juice_from_binary_format</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=kt>u8</span><span class=p>)</span><span class=w> </span><span class=p>};</span><span class=w>
</span><span class=w>    </span><span class=n>print_drink</span><span class=p>(</span><span class=o>&amp;</span><span class=n>val</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>fn</span> <span class=nf>print_drink</span><span class=p>(</span><span class=n>dri</span>: <span class=kp>&amp;</span><span class=nc>Drink</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>match</span><span class=w> </span><span class=n>dri</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=n>Drink</span>::<span class=n>Water</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=s>&#34;water&#34;</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=n>Drink</span>::<span class=n>Soda</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=s>&#34;soda&#34;</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=n>Drink</span>::<span class=n>Juice</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=s>&#34;juice&#34;</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=p>};</span><span class=w>
</span><span class=w>    </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;it&#39;s {}!&#34;</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>)</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ cargo run -q
it<span class=se>\&#39;</span>s juice!
</code></pre></div><p>å½“å‰, é€šå¸¸æˆ‘ä»¬å¸Œæœ›ç»™è¿™ä¸ªä¸å®‰å…¨æ“ä½œæä¾›ä¸€ä¸ªå®‰å…¨çš„æ¥å£:</p><div class=highlight><pre class=chroma><code class=language-rust data-lang=rust><span class=k>use</span><span class=w> </span><span class=n>std</span>::<span class=n>convert</span>::<span class=p>{</span><span class=n>TryFrom</span><span class=p>,</span><span class=w> </span><span class=n>TryInto</span><span class=p>};</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=cp>#[allow(dead_code)]</span><span class=w>
</span><span class=w></span><span class=k>enum</span> <span class=nc>Drink</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>Water</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>Soda</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>Juice</span><span class=p>,</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>impl</span><span class=w> </span><span class=n>TryFrom</span><span class=o>&lt;</span><span class=kt>i32</span><span class=o>&gt;</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>Drink</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=k>type</span> <span class=nc>Error</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=nb>&#39;static</span><span class=w> </span><span class=kt>str</span><span class=p>;</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=k>fn</span> <span class=nf>try_from</span><span class=p>(</span><span class=n>x</span>: <span class=kt>i32</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>Result</span><span class=o>&lt;</span><span class=n>Self</span><span class=p>,</span><span class=w> </span><span class=n>Self</span>::<span class=n>Error</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=k>match</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>            </span><span class=mi>0</span><span class=p>..</span><span class=o>=</span><span class=mi>2</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Ok</span><span class=p>(</span><span class=k>unsafe</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>std</span>::<span class=n>mem</span>::<span class=n>transmute</span><span class=p>(</span><span class=n>x</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=kt>u8</span><span class=p>)</span><span class=w> </span><span class=p>}),</span><span class=w>
</span><span class=w>            </span><span class=n>_</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Err</span><span class=p>(</span><span class=s>&#34;invalid Drink value&#34;</span><span class=p>),</span><span class=w>
</span><span class=w>        </span><span class=p>}</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>juice_from_binary_format</span>: <span class=kt>i32</span> <span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>;</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>val</span>: <span class=nc>Drink</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>juice_from_binary_format</span><span class=p>.</span><span class=n>try_into</span><span class=p>().</span><span class=n>unwrap</span><span class=p>();</span><span class=w>
</span><span class=w>    </span><span class=n>print_drink</span><span class=p>(</span><span class=o>&amp;</span><span class=n>val</span><span class=p>);</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>invalid_value</span>: <span class=kt>i32</span> <span class=o>=</span><span class=w> </span><span class=mi>4</span><span class=p>;</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>val</span>: <span class=nc>Drink</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>invalid_value</span><span class=p>.</span><span class=n>try_into</span><span class=p>().</span><span class=n>unwrap</span><span class=p>();</span><span class=w>
</span><span class=w>    </span><span class=n>print_drink</span><span class=p>(</span><span class=o>&amp;</span><span class=n>val</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ cargo run -q
it<span class=se>\&#39;</span>s juice!
thread <span class=s1>&#39;main&#39;</span> panicked at <span class=s1>&#39;called `Result::unwrap()` on an `Err` value: &#34;invalid Drink value&#34;&#39;</span>, src/main.rs:27:22
note: run with <span class=sb>`</span><span class=nv>RUST_BACKTRACE</span><span class=o>=</span>1<span class=sb>`</span> environment variable to display a backtrace
</code></pre></div><p>å¹¶ä¸”æˆ‘ä»¬çš„å¿«ä¹è¿˜å¹¶ä¸æ­¢æ­¥äºæ­¤.</p><p>è¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰æ‰“å°æˆ‘ä»¬çš„æšä¸¾å¤§å°ä¹ˆ? è®©æˆ‘ä»¬æ¥ <a class=link href=https://en.wikipedia.org/wiki/Memory_refresh target=_blank rel=noopener>refresh out memory</a>:</p><div class=highlight><pre class=chroma><code class=language-rust data-lang=rust><span class=k>use</span><span class=w> </span><span class=n>std</span>::<span class=n>mem</span>::<span class=n>size_of</span><span class=p>;</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=cp>#[allow(dead_code)]</span><span class=w>
</span><span class=w></span><span class=k>enum</span> <span class=nc>Drink</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>Water</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>Soda</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>Juice</span><span class=p>,</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>dbg</span><span class=o>!</span><span class=p>(</span><span class=n>size_of</span>::<span class=o>&lt;</span><span class=n>Drink</span><span class=o>&gt;</span><span class=p>());</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ cargo run -q
<span class=o>[</span>src/main.rs:11<span class=o>]</span> size_of::&lt;Drink&gt;<span class=o>()</span> <span class=o>=</span> <span class=m>1</span>
</code></pre></div><p>å•ä½æ˜¯å­—èŠ‚, æ‰€ä»¥è¿™é‡Œæ˜¾ç¤ºæˆ‘ä»¬çš„æšä¸¾åªæœ‰ä¸€ä¸ªå­—èŠ‚.</p><p>è®©æˆ‘ä»¬ä¸ <code>C</code> çš„å¯¹æ¯”ä¸‹:</p><div class=highlight><pre class=chroma><code class=language-c data-lang=c><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span><span class=cp></span>
<span class=k>typedef</span> <span class=k>enum</span> <span class=n>Drink</span> <span class=p>{</span>
    <span class=n>Drink_Water</span><span class=p>,</span>
    <span class=n>Drink_Soda</span><span class=p>,</span>
    <span class=n>Drink_Juice</span><span class=p>,</span>
<span class=p>}</span> <span class=n>Drink</span><span class=p>;</span>

<span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
    <span class=n>printf</span><span class=p>(</span><span class=s>&#34;sizeof(Drink) = %ld</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>Drink</span><span class=p>));</span>
<span class=p>}</span>
</code></pre></div><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ clang -Wall main.c -o main <span class=o>&amp;&amp;</span> ./main
sizeof<span class=o>(</span>Drink<span class=o>)</span> <span class=o>=</span> <span class=m>4</span>
</code></pre></div><p>è¿™é‡Œæšä¸¾æœ‰è¶³è¶³4ä¸ªå­—èŠ‚, æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿‘ä¼¼åœ°è¯´ <code>Rust</code> çš„æšä¸¾æ˜¯ <code>u8</code>, <code>C</code> æšä¸¾æ˜¯ <code>u32</code>.</p><p>å¦‚æœ <code>Rust</code> çš„æšä¸¾è¶…è¿‡256ä¸ªå˜ä½“å‘¢?</p><div class=highlight><pre class=chroma><code class=language-rust data-lang=rust><span class=k>use</span><span class=w> </span><span class=n>std</span>::<span class=n>mem</span>::<span class=n>size_of</span><span class=p>;</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=cp>#[allow(dead_code)]</span><span class=w>
</span><span class=w></span><span class=k>enum</span> <span class=nc>Drink</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>Variant0</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>Variant1</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>Variant2</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>Variant3</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>Variant4</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=c1>// (etc.)
</span><span class=c1></span><span class=w>    </span><span class=n>Variant252</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>Variant253</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>Variant254</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>Variant255</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>Variant256</span><span class=p>,</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>dbg</span><span class=o>!</span><span class=p>(</span><span class=n>size_of</span>::<span class=o>&lt;</span><span class=n>Drink</span><span class=o>&gt;</span><span class=p>());</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div><div class=dialog><img src=./bear.svg class=dialog-head><div class=dialog-text><p>ç­‰ç­‰, è¿™é‡Œåªæœ‰256ä¸ªå˜ä½“?</p></div></div><div class="dialog amos"><img src=./author.svg class=dialog-head><div class=dialog-text><p>Nice try cool bear, but no! <a href=https://en.wikipedia.org/wiki/Off-by-one_error#Fencepost_error>ä½ åªæ˜¯åœ¨æ•°æ …æ ä¸­çš„æ ¼å­, ä½ åº”è¯¥æ•°æ ‡æ†</a>.</p></div></div><blockquote><p>è¯‘è€…: <a class=link href=https://en.wikipedia.org/wiki/Off-by-one_error#Fencepost_error target=_blank rel=noopener>counting the fences, when you should be counting the posts.</a></p></blockquote><p>ä¸ç®¡æ€æ ·, æˆ‘ä»¬å…ˆçœ‹çœ‹ç°åœ¨çš„æšä¸¾å¤§å°?</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ cargo run -q
<span class=o>[</span>src/main.rs:265<span class=o>]</span> size_of::&lt;Drink&gt;<span class=o>()</span> <span class=o>=</span> <span class=m>2</span>
</code></pre></div><p>2ä¸ªå­—èŠ‚! çœ‹èµ·æ¥åˆåƒæ˜¯ <code>u16</code>.</p><p>å½“ç„¶çœ‹èµ·æ¥åƒå¹¶ä¸æ˜¯ä¸€ä¸ªä¸“ä¸šæœ¯è¯­ - ä¸“ä¸šæœ¯è¯­åº”è¯¥æ˜¯ &ldquo;representation&rdquo;. ä¸€ä¸ª <code>Rust</code> æšä¸¾æ˜¯å¯¹ç‰¹å®šæ•´æ•°ç±»å‹çš„æŠ½è±¡.</p><p>è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬åŸæ¥çš„ <code>Drink</code>:</p><p><img src=./representation.svg></p><p>æ¦‚å¿µä¸Š, <code>Drink</code> åªæœ‰ä¸‰ä¸ªæœ‰æ„ä¹‰çš„å€¼, ä½†æ˜¯å®ƒçš„è¡¨ç°æ˜¯ä¸€ä¸ª <code>u8</code>, èƒ½æŒæœ‰256ä¸ªä¸åŒçš„å€¼. è¿™å°±æ˜¯ä½ ä¸ºä»€ä¹ˆæ€»æ˜¯èƒ½æŠŠ <code>Drink</code> è½¬ä¸º <code>u8</code>, ä½†æ˜¯æŠŠ <code>u8</code> è½¬ä¸º <code>Drink</code> å´æ˜¯ä¸€ä¸ªå®¹æ˜“å‡ºé”™çš„æ“ä½œ.</p><div class=dialog><img src=./bear.svg class=dialog-head><div class=dialog-text><p>å› æ­¤ä½¿ç”¨ <code>TryFrom/TryInto</code> è€Œä¸æ˜¯ <code>From/Into</code></p></div></div><p>å¯¹çš„! æ½œåœ¨çš„ <code>Drink</code> ä½œä¸ºä¸€ä¸ª <code>u8</code> åº”è¯¥æ€»æ˜¯ä¸º0, 1æˆ–è€…2, è¿™è¢«ç§°ä¸ºä¸å˜ä½“(invariant). å¦‚æœæˆ‘ä»¬ç ´åäº†è¿™ä¸ªä¸å˜ä½“, æˆ‘ä»¬çš„ä»£ç å°±ä¸æ˜¯é‚£ä¹ˆå¥å£®äº†.</p><p>åœ¨ <code>Rust</code>, ç ´åä¸å˜ä½“éœ€è¦ä½¿ç”¨ <code>unsafe</code> ä»£ç :</p><div class=highlight><pre class=chroma><code class=language-rust data-lang=rust><span class=k>use</span><span class=w> </span><span class=n>std</span>::<span class=n>mem</span>::<span class=n>transmute</span><span class=p>;</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=cp>#[allow(dead_code)]</span><span class=w>
</span><span class=w></span><span class=cp>#[derive(Debug, PartialEq)]</span><span class=w>
</span><span class=w></span><span class=k>enum</span> <span class=nc>Drink</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>Water</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>Soda</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>Juice</span><span class=p>,</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=c1>// woops! that&#39;s unsound.
</span><span class=c1></span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>d</span>: <span class=nc>Drink</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>unsafe</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>transmute</span><span class=p>(</span><span class=mi>15_</span><span class=k>u8</span><span class=p>)</span><span class=w> </span><span class=p>};</span><span class=w>
</span><span class=w>    </span><span class=n>dbg</span><span class=o>!</span><span class=p>(</span><span class=o>&amp;</span><span class=n>d</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=n>dbg</span><span class=o>!</span><span class=p>(</span><span class=n>d</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>Drink</span>::<span class=n>Juice</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ cargo run -q
<span class=o>[</span>src/main.rs:14<span class=o>]</span> <span class=p>&amp;</span><span class=nv>d</span> <span class=o>=</span> Juice
<span class=o>[</span>src/main.rs:15<span class=o>]</span> <span class=nv>d</span> <span class=o>==</span> Drink::Juice <span class=o>=</span> <span class=nb>false</span>
</code></pre></div><div class=dialog><img src=./bear.svg class=dialog-head><div class=dialog-text><p>è¿™å¤ªç³Ÿäº† - ä½†æ˜¯ä½ æ²¡æ³•æ„å¤–çš„é€šè¿‡å®‰å…¨ä»£ç æ¥è·å–ä¸€ä¸ªæ— æ•ˆçš„æšä¸¾å€¼ä¸æ˜¯å—?</p></div></div><div class="dialog amos"><img src=./author.svg class=dialog-head><div class=dialog-text><p>å¯¹çš„, <code>unsafe</code>å…³é”®å­—å°†ä¸€ä¸ªåŒºåŸŸæ ‡è®°ä¸ºæ›´å°‘çš„çº¦æŸ, æ‰€ä»¥åœ¨ä»£ç å®¡æŸ¥ä¸­è¦å¯¹æœ‰æ½œåœ¨å±é™©çš„ä»£ç æ ¼å¤–æ³¨æ„.</p></div></div><div class=dialog><img src=./bear.svg class=dialog-head><div class=dialog-text><p>å¬èµ·æ¥å¾ˆç³Ÿ. æ˜¯ä¸æ˜¯æ„å‘³ç€æœ‰ <code>unsafe</code> çš„ä»£ç å°±å¾ˆç³Ÿç³•å‘¢?</p></div></div><div class="dialog amos"><img src=./author.svg class=dialog-head><div class=dialog-text><p>æœ‰æ—¶å€™æ˜¯ä¸å¯é¿å…çš„. ä½†æ˜¯ä»…ä»…æ˜¯æœ‰æ—¶å€™! åº“ä½œè€…é€šå¸¸ä¼šå‘ç°ä»–ä»¬å¹¶ä¸æ˜¯çœŸçš„éœ€è¦ <code>unsafe</code> æ¥åšä»–ä»¬æƒ³åšçš„äº‹æƒ…, ä»–ä»¬å¯ä»¥æŠŠé‚£äº›æ›¿æ¢æˆå®‰å…¨çš„ä»£ç  - è¿™ä½¿å¾—åªæœ‰æ›´å°‘çš„åŒºåŸŸéœ€è¦å»é‡ç‚¹å…³æ³¨.</p></div></div><div class=dialog><img src=./bear.svg class=dialog-head><div class=dialog-text><p>ä¸èƒ½ä½¿è¯­è¨€æœ¬èº«å®Œå…¨æ²¡æœ‰ <code>unsafe</code> ä»£ç å—?</p></div></div><div class="dialog amos"><img src=./author.svg class=dialog-head><div class=dialog-text><p>å®Œå…¨ä¸è¦ <code>unsafe</code> ä»£ç æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤§çš„è¯é¢˜, ä½†æ˜¯å½“ç„¶éœ€è¦æ›´å°‘çš„ä¸å®‰å…¨ä»£ç . ä¸¾ä¸ªä¾‹å­, æœ‰ä¸€ä¸ªä¸ºäº† <a href=https://github.com/rust-lang/project-safe-transmute>safe(r) transmute</a> çš„å·¥ä½œå°ç»„.</p></div></div><p>é—®é¢˜çš„å…³é”®åœ¨äºä¸æ˜¯æ‰€æœ‰çš„äº‹æƒ…éƒ½å¯ä»¥äº¤ç”±è®¡ç®—æœºå»åš(æ„å‘³ç€éœ€è¦ä½ è‡ªå·±å»åš), å¯ä»¥ä½¿ç”¨ <code>Rust</code> çš„æ¨¡å‹æ£€æŸ¥. å› ä¸ºç§ç§åŸå› , ä½ ä»ç„¶éœ€è¦ <code>unsafe</code> ä»£ç .</p><p>è¿™å¹¶ä¸æ„å‘³æœ‰ç€ä¸¤ç§ <code>Rust</code>, ä»…ä»…æ„å‘³ç€ä¸åŒçš„é£é™©ä»¥åŠä¸åŒçš„å¯ä¿¡ä»»ç­‰çº§.</p><p>å¦‚æœä½ ç›¸ä¿¡ <code>Rust</code> æ ¸å¿ƒå›¢é˜Ÿå¯ä»¥æ ¹é™¤æ ‡å‡†åº“ä¸­çš„ä¸å¥å…¨ä¹‹å¤„, é‚£ä¹ˆä½ ç”šè‡³å°±å¯ä»¥è®©å›¢é˜Ÿä¸­çš„åˆçº§äººå‘˜åœ¨æ­¤åŸºç¡€ä¸Šç¼–å†™å— <code>Rust</code> å®‰å…¨ä¿è¯çš„ <code>safe code</code>.</p><p><img src=./unsafe-and-trust.svg></p><h2 id=rustæšä¸¾ä¸æ­¢äºæ­¤>Rustæšä¸¾ä¸æ­¢äºæ­¤</h2><p>Cool bearæ—©å…ˆè¯´ <code>SmartString</code> æœ‰ç€ä¹°ä¸€é€ä¸€çš„å¤„ç†å­—ç¬¦ä¸²çš„æ–¹å¼. Cool bearæ˜¯å¯¹çš„!</p><p>è®©æˆ‘ä»¬æ¥è‡ªå·±åšä¸€ä¸ª <code>two-for-one</code> çš„å¤„ç†æ–¹å¼:</p><div class=highlight><pre class=chroma><code class=language-rust data-lang=rust><span class=k>enum</span> <span class=nc>UserID</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>Number</span><span class=p>(</span><span class=kt>u64</span><span class=p>),</span><span class=w>
</span><span class=w>    </span><span class=n>Text</span><span class=p>(</span><span class=nb>String</span><span class=p>),</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div><p><code>UserID</code> æ˜¯ä¸€ä¸ªåˆä½“ç±»å‹, ä¸€ä¸ª <code>UserID</code> çš„å€¼å¯ä»¥æ˜¯ä¸€ä¸ª <code>UserID::Number</code> å˜ä½“, æˆ–æ˜¯ä¸€ä¸ª <code>UserID::Text</code> å˜ä½“.å¦‚æœæˆ‘ä»¬æƒ³å¯¹å®ƒçš„å†…å®¹åšäº›æ“ä½œ, æˆ‘ä»¬éœ€è¦ç”¨æ¨¡å¼åŒ¹é…:</p><div class=highlight><pre class=chroma><code class=language-rust data-lang=rust><span class=k>fn</span> <span class=nf>print_user_id</span><span class=p>(</span><span class=n>id</span>: <span class=kp>&amp;</span><span class=nc>UserID</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=k>match</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=n>UserID</span>::<span class=n>Number</span><span class=p>(</span><span class=n>n</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>            </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;user id number {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>n</span><span class=p>);</span><span class=w>
</span><span class=w>        </span><span class=p>}</span><span class=w>
</span><span class=w>        </span><span class=n>UserID</span>::<span class=n>Text</span><span class=p>(</span><span class=n>s</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;user id {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>s</span><span class=p>),</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div><p>å¸Œæœ›ä½ å¯¹è¿™ä¸ªç”¨æ³•å¾ˆç†Ÿæ‚‰, æˆ‘ä»¬åœ¨ä¸ä¹…å‰åˆšæåˆ°è¿‡è¿™ä¸ªç”¨æ³•.</p><p>è®©æˆ‘ä»¬è¿›è¡Œä¸€æ¬¡æ‰“å°æ“ä½œ:</p><div class=highlight><pre class=chroma><code class=language-rust data-lang=rust><span class=k>fn</span> <span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>print_user_id</span><span class=p>(</span><span class=o>&amp;</span><span class=n>UserID</span>::<span class=n>Number</span><span class=p>(</span><span class=mi>79</span><span class=p>));</span><span class=w>
</span><span class=w>    </span><span class=n>print_user_id</span><span class=p>(</span><span class=o>&amp;</span><span class=n>UserID</span>::<span class=n>Text</span><span class=p>(</span><span class=s>&#34;fh99a73gbh8&#34;</span><span class=p>.</span><span class=n>into</span><span class=p>()));</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ cargo run -q
user id number <span class=m>79</span>
user id fh99a73gbh8
</code></pre></div></section><footer class=article-footer><section class=article-tags><a href=/tags/translation/>Translation</a>
<a href=/tags/rust/>Rust</a>
<a href=/tags/enum/>Enum</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section><section class=article-time><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><span class=article-time--modified>Last updated on Jan 13, 2021 15:00 +0800</span></section></footer></article><footer class=site-footer><section class=copyright>&copy;
2020 -
2021 Rabbit Hole</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=2.0.1>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const customFont=document.createElement('link');customFont.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";customFont.type="text/css";customFont.rel="stylesheet";document.head.appendChild(customFont);}());</script></body></html>